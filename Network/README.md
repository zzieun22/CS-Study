# 네트워크





...

#### IPv4

##### NAT(Network Address Translation)

사설 주소와 범용 주소의 매핑을 제공하는 동시에 가상 사설 네트워크를 지원하는 기술 -> 인터넷 네트워크 방화벽의 핵심기술이다. 사설주소의 재사용개념에 근간한 것으로 이러한 기능을 라우터에 구현함으로써 라우터는 각 포트에서 데이터를 받아 NAT매핑 규칙에 따라 IP패킷 발신지 IP주소필드를 고유한 공인 IP주소로 변환하여 전송한다. 

유형 

| NAT유형     | 내용                                                         |
| :---------- | ------------------------------------------------------------ |
| static NAT  | 내부 네트워크 주소와 외부 네트워크 주소간 일대일 매핑하도록 설정하는 방법 |
| Dynamic NAT | 내부 네트워크 주소 그룹(pool)에서 하나의 외부 네트워크 주소를 내부 네트워크 주소와 동적으로 매핑되도록 설정하는 방법 |
| Port NAT    | 여러 개의 내부 네트워크 주소를 하나 또는 몇 개의 외부 네트워크 주소에 포트번호를 다르게 하여 외부 네트워크와 통신하는 방식 |

#### IPv6 주소 체계

공간이 128비트로 들어나면서 주소부족 근본적인 문제를 해결함 



....

### 인터넷 표준



## 데이터 링크계층과 물리적 계층

데이터 링크 계층은 장치간 신호를 전달하는 물리적 계층을 이용하여 네트워크상의 



.... (못함)



### IEEE 802 표준

IEEE 802.3 프로토콜 스택에서는 데이터 링크 계층의 LLC계층에 해당하는 IEEE 802.2 가 있으며 MAC 꼐층과 물리적 계층을 포함하는 IEEE 802.3 , IEEE 802.5, Token Ring , FDDI등이 있다. 

#### IEEE 802.11 표준 





## 5. 전송계층 프로토콜 

> 음성통신도 VoIP 같은 데이터 통신으로 구현되는 것처럼 애플리케이션들이 인터넷에 기반하고 있는 추세이다. 이러한 애플리케이션과 직접적으로 연관있는 프로토콜 계층이 전송계층이면 적절한 프로토콜을 선택해야만 효과적인 네트워크를 사용할 수 있다.

클라이언트와 서버 사이에 많은 홉을 거쳐 데이터패킷이 전달되는데 , 유무선 공유기나 라우터와 같이 종단간 연결시 중간에 위치하는 노드들은 전송계층 프로토콜의 동작에 관여하지 않는다. (TCP, UDP, SCTP는 대표적으로 사용되는 전송계층 프로토콜이다.)

#### 전송 프로토콜 개념

전송계층 프로토콜은 종단호스트(End point host)간 애플리케이션 데이터를 전송해주는 역할을 한다. 서버측에서 실행되는 서버 애플리케이션은 클라이언트측에서 오는 요청을 받아서 처리한 후 그에대한 응답을 클라이언트로 보내준다. 

클라이언트-서버 구조로 동작하며 클라이언트 애플리케이션과 서버 애플리케이션을 이어주는 최하위 프로토콜이 **전송계층 프로토콜** 이다. 

전통적으로 많이 사용되어온 전송계층 프로토콜은 TCP와 UDP이며 TCP와 UDP장점을 조합한 SCTP가 새로 등장했다. 



**UDP** 는 보통 비연결서비스 라고 하는데 연결없이 서비스가 이루어 진다는 것이 아니라 연결을 위한 사전 설정 과정이 생략되고 바로 데이터를 주고 받는 것이 가능하다는 것을 의미한다. (**비신뢰성 프로토콜**)

**TCP** 는 연결지향 서비스로써 데이터를 주고 받기 전 연결을 위한 사전 설명 과정이 필요하며 데이터 송수신이 완료되면 연결을 종료하여 클라이언트 서버가 서비스를 끝내도록 한다. (**신뢰성 프로토콜**) -> seq / ack를 보내 제대로 수신하였는지 확인한다.

제대로 전송되었는지 확인 하는 Wireshark , tcpdump등을 통해서 디버깅 수행한다.



#### TCP

##### 특징

TCP는 TCP/IP모델에서 응용계층과 네트워크 계층 사이에 위치하며 , 두 응용계층 사이의 프로세스 간 통신을 제공한다. TCP는 스트림 기반 프로토콜로 데이터를 송수신하기 위한 송신 버퍼와 수신버퍼를 가진다. TCP프로토콜의 아래층에 있는 **IP는 스트림 형태가 아닌 패킷 형태**로 데이터를 전송하고, 이를 위하여 TCP는 하나의 전체 데이터를 여러개 **세그먼트** 로 나누어 처리한다. 데이터를 신뢰성 있게 전달 할 수 있도록 흐름제어 , 오류제어, 혼잡제어 기법을 정의하고 있다. 

TCP는 바이트 단위로 번호를 매김 -> 바이트 번호가 매겨지면 세그먼트 하나의 순서번호(Sequence Number)가 부여된다. 



1. **흐름제어**

   데이터 패킷을 전송할 때 수신한도를 넘는 과도한 패킷의 입력으로 패킷 분실이 발생하지 않도록 패킷의 흐름양을 조절하는 것을 흐름제어라 한다. 흐름제어 구현은 송신 측과 수신 측에서 패킷을 저장할 수 있는 송신/수신버퍼를 사용한다. 

2. **오류제어**

   전송도중에 발생한 부호오류를 검출하고, 정확한 정보를 재현하는 기술 오류 제어라고 하며, 훼손된 패킷의 감지 및 폐기, 손실되거나 제거된 패킷을 추적하고 재전송, 중복 수신 패킷을 확인하고 폐기하는 기능을 수행한다.

3. **혼잡제어** 

   단위 시간당 네트워크로 전송되는 패킷의 수를 나타내는 네트워크 부하(Load)가 단위 시간당 네트워크에서 처리할 수 있는 패킷의 수를 나타내는 네트워크 용량을 초과하는 경우에는 혼잡이 발생한다. TCP에서는 이러한 종단간 혼잡을 제어하고 네트워크 대역폭보다 부하가 적게 걸리도록 하기 위하여 혼잡제어를 한다.

   

   ![1](/Users/PARKHASIK/Desktop/screen shot/1.png)

   

   ![2](/Users/PARKHASIK/Desktop/screen shot/2.png)




​	

1. TCP연결 설정

   TCP연결을 설정하는 기본 방법이 three-way handshake procedure 이다. 이 절차는 하나의 TCP종단에서 다른 종단으로 순서번호(seq) 가 100 인 SYN세그먼트를 보냄으로써 시작되며 SYN세그먼트는 TCP헤더의 SYN제어 플래그가 1로 설정 된 것을 의미한다. ACK세그먼트는 ACK제어 플래그가 1로 설정된 것이며, SYN,ACK세그먼트는 SYN제어 플래그와 ACK제어 플래그가 모두 1로 설정 되어 있음을 의미한다. 

   SYN세그먼트를 수신한 TCP B는 이에 대한 응답으로 확인 응답번호 101과함께 TCP B에서도 TCP A로 연결 설정을 요청하는 SYN제어 플래그(SEQ=300)을 설정하여 SYN, ACK 세그먼트를 그림3의 3번과 같이 보낸다. 이를 수신한 TCP A 는 ACK제어 플래그와 ACK=101을 확인하여 연결 요청이 제대로 전달된 것을 알 수 있다. 또한 SYN제어 플래그가 같이 설정되어 있어 TCP B에서 연결 요청이 왔음을 알 수 있어 이에대한 ACK세그먼트를 TCP B에 보냄으로써 세 방향 핸드쉐이크가 완성되어 TCP A TCP B간에 양 방향 연결이 설정되었음을 알 수 있다. 

   ![3](/Users/PARKHASIK/Desktop/screen shot/3.png)


2. TCP연결 종료(연결을 종료할 때는 4 way handshake 수행)

   TCP연결 종료는 다음의 순서로 이루어진다. 연결종료를 원하는 종단 TCP A에서 FIN 세그먼트 (SEQ=100, ACK =300)를 단계2와 같이 TCP B로 보낸다. 여기서는 이전 전송에 대한 확인 응답으로 ACK제어 플래그를 같이 설정하여 보내고 있다. 이를 수신한 TCP B에서는 단계 3과 같이 이에대한 ACK세그먼트(SEQ=300, ACK=101)를 응답으로 보낸다. FIN세그먼트의 SEQ=100에 대한 응답으로 ACK는 1증가한 101이 전송된다. 

   이제 TCP B는 단계 4에서처럼 연결종료를 위하여 FIN세그먼트를 TCP A로 보낸다. 단계2에서와 마찬가지로 이전 데이터 전송에 대한 확인 응답을 위하여 ACK를 같이 보내고 있다. 그러면 TCP A는 단계 5와 같이 이에대한 ACK세그먼트를 보내어 TCP연결을 완전히 종료하게 된다. 

![4](/Users/PARKHASIK/Desktop/screen shot/4.png)

**흐름제어** -> 슬라이딩 윈도우 프로토콜을 사용한다.

**오류제어**-> 전송된 세그먼트가 손실되었거나 훼손된 경우 순서가 어긋나는 경우 , 또흔 중복되는 경우에 이에대한 처리기능을 수행하는 것이다.(검사합, 확인응답, 재전송)

**혼잡제어** -> 네트워크로 유입되는 사용자 트래픽양이 네트워크 용량을 초과하지 않도록 유지시키는 매커니즘과 기술이 느린 시작 알고리즘과 혼잡회피 알고리즘 기반으로 혼잡제어 수행한다.



**3 Way (Three Way) Handshake**



![5](/Users/PARKHASIK/Desktop/screen shot/5.png)



**4 Way (Four Way) Handshake**

![6](/Users/PARKHASIK/Desktop/screen shot/6.png)





